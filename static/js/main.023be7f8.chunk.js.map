{"version":3,"sources":["events/bus.js","events/index.js","widgets/Controls.module.css","gui/PlayScreen.module.css","gui/PlayScreenEgg.module.css","emulator/Screen.js","emulator/FrameTimer.js","emulator/Speakers.js","emulator/controllers/Controller.js","emulator/controllers/LocalController.js","locales/index.js","locales/strings.js","emulator/index.js","emulator/Emulator.js","widgets/BalloonMessage.js","widgets/Header.js","networking/transfer/Send.js","networking/transfer/Receive.js","networking/MasterSyncer.js","networking/SlaveSyncer.js","gui/InviteHeader.js","gui/JoinHeader.js","widgets/KeyBinding.js","gui/Settings.js","gui/Overlay.js","widgets/TVNoise.js","gui/helpers/index.js","gui/helpers/cleanQueryString.js","gui/helpers/ellipsize.js","widgets/Controls.js","widgets/SettingsButton.js","gui/PlayScreen.js","gui/PlayScreenEgg.js","App.js","index.js","widgets/Header.module.css","gui/Overlay.module.css","gui/Settings.module.css","widgets/BalloonMessage.module.css","emulator/Screen.module.css","assets/rodrigo_profile_picture.png","widgets/SettingsButton.module.css","config.js"],"names":["bus","EventEmitter","module","exports","controls","title","controller","dpad","buttons","centered","startSelect","app","main","gameContainer","overlay","menu","appegg","Screen","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","setBuffer","bind","assertThisInitialized","writeBuffer","_this2","react_default","a","createElement","className","styles","screen","width","height","ref","canvas","_initCanvas","buffer","y","x","i","buf32","imageData","data","set","buf8","context","putImageData","getContext","getImageData","fillStyle","fillRect","buf","ArrayBuffer","length","Uint8ClampedArray","Uint32Array","Component","FPS","FrameTimer","onFrame","fps","arguments","undefined","_run","_isRunning","_frameId","requestAnimationFrame","now","Date","elapsedTime","_lastTime","_interval","_fps","_startTime","cancelAnimationFrame","BUFFER_SIZE","Speakers","bufferSize","RingBuffer","writeSample","_onAudioProcess","audioCtx","window","AudioContext","scriptNode","createScriptProcessor","onaudioprocess","gainNode","createGain","gain","value","config","sound","connect","destination","on","disconnect","close","catch","console","error","removeListener","sampleRate","left","right","size","deqN","enq","event","samples","outputBuffer","getChannelData","e","BITS","Controller","player","getNes","BUTTON_A","BUTTON_B","BUTTON_SELECT","BUTTON_START","BUTTON_UP","BUTTON_DOWN","BUTTON_LEFT","BUTTON_RIGHT","byte","sync","button","isPressed","nes","buttonDown","jsnes","buttonUp","syncAll","toByte","source","LocalController","onStart","_processGamepadIfPossible","gamepad","_","first","navigator","getGamepads","mapping","usesGamepad","confirm","concat","id","emit","pressed","_setButton","_onKeyDown","keyMap","key","_onKeyUp","isMaster","needsSwap","immediateButtons","clone","options","input","otherController","otherPlayer","resync","esm_get","prototype","$gamepadInterval","setInterval","addEventListener","removeEventListener","clearInterval","_sync","strings","buffering","connected","connecting","copied","crtEffect","dragARomHere","enabled_false","enabled_true","errors","connectionFailed","invalidRom","serverIsDown","link","loading","pressStart","setDefaults","settings","shareThis","swap","swapButton","toPlayWithSomeone","waiting","yourController","Emulator","localController","onStartPressed","remoteController","Screen_Screen","_initialize","attach","nextProps","stop","frameTimer","start","speakers","frame","onError","detach","_this3","_this$props","rom","bytes","Buffer","from","toString","NES","onAudioSample","getSampleRate","syncer","loadROM","emulator","BalloonMessage","children","classNames","balloon","character","src","rodrigoImage","alt","Header","state","header","small","isEmpty","lib","animationIn","animationOut","isVisible","BalloonMessage_BalloonMessage","message","Send","channel","_sent","_total","byteLength","send","remaining","Math","min","chunk","slice","Receive","_received","_appendBuffer","buffer1","buffer2","tmp","Uint8Array","STATE","MasterSyncer","_reset","_onData","masterBufferLimit","_state","_blindFrames","_runFrame","_transfer","run","initializeRom","_emulator","swapWith","_buffer","excess","shift","remoteButtons","remoteControllerNeedsSwap","onSwap","_start","push","SlaveSyncer","_hasPressedStart","_config$buffering","minBufferSize","maxBufferSize","_isBuffering","localButtons","remotePlayer","COPIED_MESSAGE_TIME","InviteHeader","token","isDown","_copyLink","preventDefault","clipboard","writeText","target","href","setState","setTimeout","needsRom","_this$state","Header_Header","onClick","tabIndex","onSyncer","onConnectionError","quickp2p","createChannel","JoinHeader","joinChannel","KeyBinding","_onAssign","isAssigning","onAssignCancel","onAssignStart","displayName","_this$props$verticalM","verticalMirror","type","style","transform","display","DEFAULT_SCREEN_WIDTH","BUTTONS","name","Settings","mappingButton","_onClose","_onSetDefaults","reset","_notify","oldKey","findKey","it","newKey","save","_onResize","innerWidth","element","document","querySelector","scale","closeButton","setDefaultsButton","soundOptions","map","checked","onChange","_update","bufferingOptions","crt","KeyBinding_KeyBinding","property","container","classList","add","remove","forceUpdate","Overlay","isSettingsMenuOpen","isLoading","show","loader","dark","Settings_Settings","react_loader_spinner_default","color","TVNoise","borderRadius","self","toggle","loop","ctx","w","h","idata","createImageData","buffer32","len","random","noise","helpers","cleanQueryString","url","location","replace","substring","indexOf","history","replaceState","ellipsize","string","limit","FRIENDLY_NAMES","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," ","Controls","_onGamepadConnected","blink","upKey","_keyFor","isUpArrow","Fragment","_format","toUpperCase","SettingsButton","_onClick","require","default","PlayScreen","_onSyncer","_loadRom","initializeEmulator","_onFileDrop","file","dataTransfer","files","reader","FileReader","onload","result","updateRom","readAsArrayBuffer","_ignore","stopPropagation","_onStartPressed","_onError","JoinHeader_JoinHeader","InviteHeader_InviteHeader","Overlay_Overlay","src_emulator","TVNoise_TVNoise","Controls_Controls","SettingsButton_SettingsButton","callback","noop","dataURI","byteString","ab","ia","charCodeAt","Blob","setStore","SimpleStore","App","hash","startsWith","PlayScreen_PlayScreen","inviteToken","_listener","querystring","parse","search","egg","PureComponent","ReactDOM","render","App_App","getElementById","titleLogo","titleText","__webpack_require__","p","Config","M_ESTUDOS_quickp2p_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","defaultOptions","load","localStorage","setItem","JSON","stringify","getItem","find","z","Delete","Enter","r","__webpack_exports__"],"mappings":"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","file":"static/js/main.023be7f8.chunk.js","sourcesContent":["import EventEmitter from \"eventemitter3\";\r\n\r\nexport default new EventEmitter();\r\n","import bus from \"./bus\";\r\n\r\nexport default bus;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"controls\":\"Controls_controls__3YMsS\",\"title\":\"Controls_title__SE0bN\",\"controller\":\"Controls_controller__2J85L\",\"dpad\":\"Controls_dpad__1g8h3\",\"buttons\":\"Controls_buttons__2tQIl\",\"centered\":\"Controls_centered__3cY2f\",\"startSelect\":\"Controls_startSelect__2P8mU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"PlayScreen_app__YqH5A\",\"main\":\"PlayScreen_main__20Puq\",\"gameContainer\":\"PlayScreen_gameContainer__RZY8A\",\"overlay\":\"PlayScreen_overlay__3Bp0l\",\"controls\":\"PlayScreen_controls__3f5hq\",\"menu\":\"PlayScreen_menu__2C0GC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"appegg\":\"PlayScreenEgg_appegg__23xP7\",\"main\":\"PlayScreenEgg_main__34O2l\",\"gameContainer\":\"PlayScreenEgg_gameContainer__30zBy\",\"overlay\":\"PlayScreenEgg_overlay__jnd1F\",\"controls\":\"PlayScreenEgg_controls__34h85\",\"menu\":\"PlayScreenEgg_menu__2iOqt\"};","import React, { Component } from \"react\";\r\nimport styles from \"./Screen.module.css\";\r\n\r\nconst SCREEN_WIDTH = 256;\r\nconst SCREEN_HEIGHT = 240;\r\nconst FULL_ALPHA = 0xff000000;\r\n\r\nexport default class Screen extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.setBuffer = this.setBuffer.bind(this);\r\n\t\tthis.writeBuffer = this.writeBuffer.bind(this);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<canvas\r\n\t\t\t\tclassName={styles.screen}\r\n\t\t\t\twidth={SCREEN_WIDTH}\r\n\t\t\t\theight={SCREEN_HEIGHT}\r\n\t\t\t\tref={(canvas) => {\r\n\t\t\t\t\tif (canvas) this._initCanvas(canvas);\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tsetBuffer(buffer) {\r\n\t\tfor (let y = 0; y < SCREEN_HEIGHT; ++y) {\r\n\t\t\tfor (let x = 0; x < SCREEN_WIDTH; ++x) {\r\n\t\t\t\tconst i = y * SCREEN_WIDTH + x;\r\n\t\t\t\t// Convert pixel from NES BGR to canvas ABGR\r\n\t\t\t\tthis.buf32[i] = FULL_ALPHA | buffer[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\twriteBuffer() {\r\n\t\tthis.imageData.data.set(this.buf8);\r\n\t\tthis.context.putImageData(this.imageData, 0, 0);\r\n\t}\r\n\r\n\t_initCanvas(canvas) {\r\n\t\tthis.context = canvas.getContext(\"2d\");\r\n\t\tthis.imageData = this.context.getImageData(\r\n\t\t\t0,\r\n\t\t\t0,\r\n\t\t\tSCREEN_WIDTH,\r\n\t\t\tSCREEN_HEIGHT\r\n\t\t);\r\n\r\n\t\t// Set alpha to opaque\r\n\t\tthis.context.fillStyle = \"black\";\r\n\t\tthis.context.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\r\n\r\n\t\t// Buffer to write on next animation frame\r\n\t\tthis.buf = new ArrayBuffer(this.imageData.data.length);\r\n\r\n\t\t// Get the canvas buffer in 8bit and 32bit\r\n\t\tthis.buf8 = new Uint8ClampedArray(this.buf);\r\n\t\tthis.buf32 = new Uint32Array(this.buf);\r\n\r\n\t\t// Set alpha\r\n\t\tfor (let i = 0; i < this.buf32.length; ++i) {\r\n\t\t\tthis.buf32[i] = FULL_ALPHA;\r\n\t\t}\r\n\t}\r\n}\r\n","const FPS = 60.098;\r\n\r\nexport default class FrameTimer {\r\n\tconstructor(onFrame, fps = FPS) {\r\n\t\tthis.onFrame = onFrame;\r\n\r\n\t\tthis._fps = fps;\r\n\t\tthis._interval = 1000 / fps;\r\n\t\tthis._lastTime = Date.now();\r\n\t\tthis._startTime = this._lastTime;\r\n\t\tthis._isRunning = false;\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis._isRunning = true;\r\n\t\tthis._run();\r\n\t}\r\n\r\n\tstop() {\r\n\t\tthis._isRunning = false;\r\n\t\tcancelAnimationFrame(this._frameId);\r\n\t}\r\n\r\n\t_run = () => {\r\n\t\tif (!this._isRunning) return;\r\n\t\tthis._frameId = requestAnimationFrame(this._run);\r\n\r\n\t\tconst now = Date.now();\r\n\t\tconst elapsedTime = now - this._lastTime;\r\n\r\n\t\tif (elapsedTime > this._interval) {\r\n\t\t\tthis._lastTime = now - (elapsedTime % this._interval);\r\n\t\t\tthis.onFrame();\r\n\t\t}\r\n\t};\r\n}\r\n","import RingBuffer from \"ringbufferjs\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\n\r\nconst BUFFER_SIZE = 8192;\r\nconst DEFAULT_SAMPLE_RATE = 44100;\r\n\r\nexport default class Speakers {\r\n\tconstructor() {\r\n\t\tthis.bufferSize = BUFFER_SIZE;\r\n\t\tthis.buffer = new RingBuffer(this.bufferSize * 2);\r\n\r\n\t\tthis.writeSample = this.writeSample.bind(this);\r\n\t\tthis._onAudioProcess = this._onAudioProcess.bind(this);\r\n\t}\r\n\r\n\tstart() {\r\n\t\tif (this.audioCtx) return;\r\n\t\tif (!window.AudioContext) return; // (audio is not supported)\r\n\r\n\t\tthis.audioCtx = new window.AudioContext();\r\n\t\tthis.scriptNode = this.audioCtx.createScriptProcessor(1024, 0, 2);\r\n\t\tthis.scriptNode.onaudioprocess = this._onAudioProcess;\r\n\t\tthis.gainNode = this.audioCtx.createGain();\r\n\t\tthis.gainNode.gain.value = config.sound.gain;\r\n\t\tthis.gainNode.connect(this.audioCtx.destination);\r\n\t\tthis.scriptNode.connect(this.gainNode);\r\n\r\n\t\tbus.on(\r\n\t\t\t\"volume\",\r\n\t\t\t(gain) => this.gainNode && (this.gainNode.gain.value = gain)\r\n\t\t);\r\n\t}\r\n\r\n\tstop() {\r\n\t\tif (this.scriptNode) {\r\n\t\t\tthis.gainNode.disconnect(this.audioCtx.destination);\r\n\t\t\tthis.scriptNode.disconnect(this.gainNode);\r\n\t\t\tthis.scriptNode.onaudioprocess = null;\r\n\t\t\tthis.scriptNode = null;\r\n\t\t\tthis.gainNode = null;\r\n\t\t}\r\n\r\n\t\tif (this.audioCtx) {\r\n\t\t\tthis.audioCtx.close().catch(console.error);\r\n\t\t\tthis.audioCtx = null;\r\n\t\t}\r\n\r\n\t\tbus.removeListener(\"volume\");\r\n\t}\r\n\r\n\tgetSampleRate() {\r\n\t\tif (!window.AudioContext) return DEFAULT_SAMPLE_RATE;\r\n\r\n\t\tconst context = new window.AudioContext();\r\n\t\tconst sampleRate = context.sampleRate;\r\n\t\tcontext.close();\r\n\r\n\t\treturn sampleRate;\r\n\t}\r\n\r\n\twriteSample(left, right) {\r\n\t\tif (this.buffer.size() / 2 >= this.bufferSize) {\r\n\t\t\t// buffer overrun\r\n\t\t\tthis.buffer.deqN(this.bufferSize / 2);\r\n\t\t}\r\n\r\n\t\tthis.buffer.enq(left);\r\n\t\tthis.buffer.enq(right);\r\n\t}\r\n\r\n\t_onAudioProcess(event) {\r\n\t\tconst left = event.outputBuffer.getChannelData(0);\r\n\t\tconst right = event.outputBuffer.getChannelData(1);\r\n\t\tconst size = left.length;\r\n\r\n\t\tlet samples;\r\n\t\ttry {\r\n\t\t\tsamples = this.buffer.deqN(size * 2);\r\n\t\t} catch (e) {\r\n\t\t\t// buffer underrun (needed {size}, got {this.buffer.size() / 2})\r\n\t\t\t// ignore empty buffers... assume audio has just stopped\r\n\r\n\t\t\tfor (let i = 0; i < size; i++) {\r\n\t\t\t\tleft[i] = 0;\r\n\t\t\t\tright[i] = 0;\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < size; i++) {\r\n\t\t\tleft[i] = samples[i * 2];\r\n\t\t\tright[i] = samples[i * 2 + 1];\r\n\t\t}\r\n\t}\r\n}\r\n","import jsnes from \"jsnes\";\r\n\r\nconst BITS = [\r\n\t0b00000001,\r\n\t0b00000010,\r\n\t0b00000100,\r\n\t0b00001000,\r\n\t0b00010000,\r\n\t0b00100000,\r\n\t0b01000000,\r\n\t0b10000000\r\n];\r\n\r\nexport default class Controller {\r\n\tconstructor(player = 1, getNes) {\r\n\t\tthis.player = player;\r\n\t\tthis.getNes = getNes;\r\n\r\n\t\tthis.buttons = {\r\n\t\t\tBUTTON_A: false,\r\n\t\t\tBUTTON_B: false,\r\n\t\t\tBUTTON_SELECT: false,\r\n\t\t\tBUTTON_START: false,\r\n\t\t\tBUTTON_UP: false,\r\n\t\t\tBUTTON_DOWN: false,\r\n\t\t\tBUTTON_LEFT: false,\r\n\t\t\tBUTTON_RIGHT: false\r\n\t\t};\r\n\t}\r\n\r\n\tsyncAll(byte) {\r\n\t\tthis.sync(\"BUTTON_A\", !!(byte & BITS[0]));\r\n\t\tthis.sync(\"BUTTON_B\", !!(byte & BITS[1]));\r\n\t\tthis.sync(\"BUTTON_SELECT\", !!(byte & BITS[2]));\r\n\t\tthis.sync(\"BUTTON_START\", !!(byte & BITS[3]));\r\n\t\tthis.sync(\"BUTTON_UP\", !!(byte & BITS[4]));\r\n\t\tthis.sync(\"BUTTON_DOWN\", !!(byte & BITS[5]));\r\n\t\tthis.sync(\"BUTTON_LEFT\", !!(byte & BITS[6]));\r\n\t\tthis.sync(\"BUTTON_RIGHT\", !!(byte & BITS[7]));\r\n\t}\r\n\r\n\tsync(button, isPressed) {\r\n\t\tconst nes = this.getNes();\r\n\r\n\t\tthis.buttons[button] = isPressed;\r\n\r\n\t\tif (isPressed) nes.buttonDown(this.player, jsnes.Controller[button]);\r\n\t\telse nes.buttonUp(this.player, jsnes.Controller[button]);\r\n\t}\r\n\r\n\tresync() {\r\n\t\tthis.syncAll(this.toByte());\r\n\t}\r\n\r\n\ttoByte(source = this.buttons) {\r\n\t\treturn (\r\n\t\t\t(source.BUTTON_A && BITS[0]) |\r\n\t\t\t(source.BUTTON_B && BITS[1]) |\r\n\t\t\t(source.BUTTON_SELECT && BITS[2]) |\r\n\t\t\t(source.BUTTON_START && BITS[3]) |\r\n\t\t\t(source.BUTTON_UP && BITS[4]) |\r\n\t\t\t(source.BUTTON_DOWN && BITS[5]) |\r\n\t\t\t(source.BUTTON_LEFT && BITS[6]) |\r\n\t\t\t(source.BUTTON_RIGHT && BITS[7])\r\n\t\t);\r\n\t}\r\n}\r\n","import Controller from \"./Controller\";\r\nimport config from \"../../config\";\r\nimport bus from \"../../events\";\r\nimport _ from \"lodash\";\r\n\r\nexport default class LocalController extends Controller {\r\n\tconstructor(player, getNes, onStart = () => {}) {\r\n\t\tsuper(player, getNes);\r\n\r\n\t\tthis.isMaster = true;\r\n\t\tthis.needsSwap = false;\r\n\t\tthis.immediateButtons = _.clone(this.buttons);\r\n\t\tthis.onStart = onStart;\r\n\t\tthis.keyMap = config.options.input;\r\n\t}\r\n\r\n\tswapWith(otherController) {\r\n\t\tconst otherPlayer = otherController.player;\r\n\t\totherController.player = this.player;\r\n\t\tthis.player = otherPlayer;\r\n\r\n\t\tthis.needsSwap = false;\r\n\t\tthis.resync();\r\n\t\totherController.resync();\r\n\t\treturn otherPlayer;\r\n\t}\r\n\r\n\tresync() {\r\n\t\tthis.syncAll(super.toByte());\r\n\t}\r\n\r\n\ttoByte() {\r\n\t\treturn super.toByte(this.immediateButtons);\r\n\t}\r\n\r\n\tattach() {\r\n\t\tthis.$gamepadInterval = setInterval(this._processGamepadIfPossible, 10);\r\n\r\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\r\n\t\twindow.addEventListener(\"keyup\", this._onKeyUp);\r\n\t\tbus.on(\"keymap-updated\", () => (this.keyMap = config.options.input));\r\n\t}\r\n\r\n\tdetach() {\r\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDown);\r\n\t\twindow.removeEventListener(\"keyup\", this._onKeyUp);\r\n\t\tbus.removeListener(\"keymap-updated\");\r\n\t\tclearInterval(this.$gamepadInterval);\r\n\t}\r\n\r\n\t_processGamepadIfPossible = () => {\r\n\t\tconst gamepad = _.first(navigator.getGamepads());\r\n\t\tif (!gamepad || gamepad.mapping !== \"standard\") return;\r\n\r\n\t\tif (window.usesGamepad === undefined) {\r\n\t\t\twindow.usesGamepad = window.confirm(`Use ${gamepad.id}?`);\r\n\t\t\tif (window.usesGamepad) bus.emit(\"gamepad\");\r\n\t\t}\r\n\t\tif (!window.usesGamepad) return;\r\n\r\n\t\tconst isPressed = (id) => gamepad.buttons[id].pressed;\r\n\r\n\t\tthis._setButton(\"BUTTON_A\", isPressed(1));\r\n\t\tthis._setButton(\"BUTTON_B\", isPressed(0));\r\n\t\tthis._setButton(\"BUTTON_SELECT\", isPressed(8));\r\n\t\tthis._setButton(\"BUTTON_START\", isPressed(9));\r\n\t\tthis._setButton(\"BUTTON_UP\", isPressed(12));\r\n\t\tthis._setButton(\"BUTTON_DOWN\", isPressed(13));\r\n\t\tthis._setButton(\"BUTTON_LEFT\", isPressed(14));\r\n\t\tthis._setButton(\"BUTTON_RIGHT\", isPressed(15));\r\n\t\tthis._setButton(\"SWAP\", isPressed(5));\r\n\t};\r\n\r\n\t_onKeyDown = (e) => {\r\n\t\tif (window.usesGamepad) return;\r\n\r\n\t\tconst button = this.keyMap[e.key];\r\n\t\tif (!button) return;\r\n\r\n\t\tthis._setButton(button, true);\r\n\t};\r\n\r\n\t_onKeyUp = (e) => {\r\n\t\tif (window.usesGamepad) return;\r\n\r\n\t\tconst button = this.keyMap[e.key];\r\n\t\tif (!button) return;\r\n\r\n\t\tthis._setButton(button, false);\r\n\t};\r\n\r\n\t_setButton(button, isPressed) {\r\n\t\tif (button === \"BUTTON_START\" && isPressed) this.onStart();\r\n\t\tif (button === \"SWAP\") {\r\n\t\t\tif (this.player === 1 && isPressed) this.needsSwap = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._sync(button, isPressed);\r\n\t}\r\n\r\n\t_sync(button, isPressed) {\r\n\t\tthis.immediateButtons[button] = isPressed;\r\n\t\tif (this.isMaster) this.sync(button, isPressed);\r\n\t}\r\n}\r\n","import strings from \"./strings\";\r\n\r\nexport default strings;\r\n","export default {\r\n\tbuffering: \"Buffering\",\r\n\tconnected: \"Conectado!\",\r\n\tconnecting: \"Conectando...\",\r\n\tcontrols: \"- Seu Controle -\",\r\n\tcopied: \"Copiado!\",\r\n\tcrtEffect: \"Efeito CRT\",\r\n\tdragARomHere: \"Arraste uma ROM de NES aqui!\",\r\n\tenabled_false: \"Desabilitado\",\r\n\tenabled_true: \"Habilitado\",\r\n\terrors: {\r\n\t\tconnectionFailed: \"CONEXÃO FALHOU :(\",\r\n\t\tinvalidRom: \"ROM inválida :(\",\r\n\t\tserverIsDown: \"O servidor multiplayer não está online :(\"\r\n\t},\r\n\tinput: \"Controle\",\r\n\tlink: \"link\",\r\n\tloading: \"Carregando...\",\r\n\tpressStart: \"APERTE START\",\r\n\tsetDefaults: \"Restaurar padrões\",\r\n\tsettings: \"Configurações\",\r\n\tshareThis: \"Compartilhe o\",\r\n\tsound: \"Som\",\r\n\tswap: \"Troca de controle\",\r\n\tswapButton: \"RB\",\r\n\ttoPlayWithSomeone: \"para jogar com alguém!\",\r\n\twaiting: \"Aguardando...\",\r\n\tyourController: \"Seu controle\"\r\n};\r\n","import Emulator from \"./Emulator\";\r\n\r\nexport default Emulator;\r\n","import React, { Component } from \"react\";\r\nimport { Buffer } from \"buffer\";\r\nimport Screen from \"./Screen\";\r\nimport FrameTimer from \"./FrameTimer\";\r\nimport Speakers from \"./Speakers\";\r\nimport { Controller, LocalController } from \"./controllers\";\r\nimport strings from \"../locales\";\r\nimport jsnes, { NES } from \"jsnes\";\r\n\r\nexport default class Emulator extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tconst getNes = () => this.nes;\r\n\t\tthis.localController = new LocalController(1, getNes, props.onStartPressed);\r\n\t\tthis.remoteController = new Controller(2, getNes);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Screen\r\n\t\t\t\tref={(screen) => {\r\n\t\t\t\t\tif (screen) this._initialize(screen);\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.localController.attach();\r\n\t}\r\n\r\n\tcomponentWillUpdate(nextProps) {\r\n\t\tthis.stop();\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis.frameTimer.start();\r\n\t\tthis.speakers.start();\r\n\t}\r\n\r\n\tstop() {\r\n\t\tthis.frameTimer.stop();\r\n\t\tthis.speakers.stop();\r\n\t}\r\n\r\n\tframe() {\r\n\t\ttry {\r\n\t\t\tthis.nes.frame();\r\n\t\t\tthis.screen.writeBuffer();\r\n\t\t} catch (e) {\r\n\t\t\tthis.props.onError(strings.errors.invalidRom, false);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.stop();\r\n\t\tthis.localController.detach();\r\n\t}\r\n\r\n\t_initialize(screen) {\r\n\t\tconst { rom, onError } = this.props;\r\n\t\tif (!rom) return;\r\n\t\tconst bytes = Buffer.from(rom).toString(\"binary\");\r\n\r\n\t\tthis.screen = screen;\r\n\r\n\t\tthis.speakers = new Speakers();\r\n\r\n\t\tthis.nes = new NES({\r\n\t\t\tonFrame: this.screen.setBuffer,\r\n\t\t\tonAudioSample: this.speakers.writeSample,\r\n\t\t\tsampleRate: this.speakers.getSampleRate()\r\n\t\t});\r\n\r\n\t\tthis.frameTimer = new FrameTimer(() => {\r\n\t\t\tconst { syncer } = this.props;\r\n\r\n\t\t\tif (syncer) syncer.sync();\r\n\t\t\telse this.frame();\r\n\t\t});\r\n\r\n\t\t// Load ROM data as a string and start\r\n\t\ttry {\r\n\t\t\tthis.nes.loadROM(bytes);\r\n\t\t} catch (e) {\r\n\t\t\tonError(strings.errors.invalidRom, false);\r\n\t\t}\r\n\r\n\t\t// DEBUG\r\n\t\twindow.emulator = this;\r\n\t\twindow.jsnes = jsnes;\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\nimport styles from \"./BalloonMessage.module.css\";\r\n// import haluImage from \"../assets/halu.svg\";\r\nimport rodrigoImage from \"../assets/rodrigo_profile_picture.png\"\r\nimport classNames from \"classnames\";\r\n\r\nexport default class BalloonMessage extends Component {\r\n\trender() {\r\n\t\tconst { children } = this.props;\r\n\r\n\t\treturn (\r\n\t\t\t<section className=\"message -left\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={classNames(\r\n\t\t\t\t\t\tstyles.balloon,\r\n\t\t\t\t\t\t\"nes-balloon\",\r\n\t\t\t\t\t\t\"from-left\",\r\n\t\t\t\t\t\t\"is-small\"\r\n\t\t\t\t\t)}\r\n\t\t\t\t>\r\n\t\t\t\t\t<p>{children}</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<br />\r\n\t\t\t\t<img className={styles.character} src={rodrigoImage} alt=\"character\" />\r\n\t\t\t</section>\r\n\t\t);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\nimport BalloonMessage from \"./BalloonMessage\";\r\nimport styles from \"./Header.module.css\";\r\nimport classNames from \"classnames\";\r\nimport _ from \"lodash\";\r\nimport {Animated} from \"react-animated-css\";\r\n\r\n\r\nexport default class Header extends Component {\r\n\tstate = { bytes: null };\r\n\r\n\trender() {\r\n\t\tconst { children } = this.props;\r\n\r\n\t\treturn (\r\n\t\t\t<div className={styles.header}>\r\n\t\t\t\t<div className={styles.small}>\r\n\t\t\t\t\t{!_.isEmpty(children) && (\r\n\t\t\t\t\t\t<Animated animationIn=\"bounceInLeft\" animationOut=\"fadeOut\" isVisible={true}>\r\n\r\n\t\t\t\t\t\t\t<BalloonMessage\r\n\t\t\t\t\t\t\t\tclassName={classNames(styles.message, styles.small)}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{children}\r\n\t\t\t\t\t\t\t</BalloonMessage>\r\n\t\t\t\t\t\t</Animated>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<h2 className={styles.title}>\r\n\t\t\t\t\t{/* <div>\r\n\t\t\t\t\t\t<i className={classNames(styles.titleLogo, \"nes-logo\")} />\r\n\t\t\t\t\t\t<span className={styles.titleText}>NEStation</span>\r\n\t\t\t\t\t</div> */}\r\n\r\n\t\t\t\t\t{/* <div>\r\n\t\t\t\t\t\t<a\r\n\t\t\t\t\t\t\thref=\"https://github.com/rodri042/nestation#nestation\"\r\n\t\t\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\t\t\trel=\"noopener noreferrer\"\r\n\t\t\t\t\t\t\ttabIndex=\"-1\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<i\r\n\t\t\t\t\t\t\t\tclassName={classNames(\r\n\t\t\t\t\t\t\t\t\tstyles.link,\r\n\t\t\t\t\t\t\t\t\tstyles.titleLogo,\r\n\t\t\t\t\t\t\t\t\t\"nes-octocat\"\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t</div> */}\r\n\t\t\t\t</h2>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n","const CHUNK_SIZE = 1024;\r\n\r\nexport default class Send {\r\n\tconstructor(rom, channel) {\r\n\t\tthis.rom = rom;\r\n\t\tthis.channel = channel;\r\n\r\n\t\tthis._sent = 0;\r\n\t\tthis._total = rom.byteLength;\r\n\t}\r\n\r\n\trun() {\r\n\t\tif (this._sent === this._total) {\r\n\t\t\tthis.channel.send(\"end\");\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst remaining = this._total - this._sent;\r\n\t\tconst size = Math.min(CHUNK_SIZE, remaining);\r\n\t\tconst chunk = this.rom.slice(this._sent, this._sent + size);\r\n\r\n\t\tthis._sent += size;\r\n\t\tthis.channel.send(chunk);\r\n\t}\r\n\r\n\tget transferred() {\r\n\t\treturn this._sent;\r\n\t}\r\n}\r\n","export default class Receive {\r\n\tconstructor(channel) {\r\n\t\tthis.rom = new ArrayBuffer();\r\n\t\tthis.channel = channel;\r\n\r\n\t\tthis._received = 0;\r\n\t}\r\n\r\n\trun(bytes) {\r\n\t\tthis.rom = this._appendBuffer(this.rom, bytes);\r\n\r\n\t\tthis._received += bytes.byteLength;\r\n\t\tthis.channel.send(\"next\");\r\n\t}\r\n\r\n\t_appendBuffer(buffer1, buffer2) {\r\n\t\tvar tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\r\n\t\ttmp.set(new Uint8Array(buffer1), 0);\r\n\t\ttmp.set(new Uint8Array(buffer2), buffer1.byteLength);\r\n\t\treturn tmp.buffer;\r\n\t}\r\n\r\n\tget transferred() {\r\n\t\treturn this._received;\r\n\t}\r\n}\r\n","import EventEmitter from \"eventemitter3\";\r\nimport { Send } from \"./transfer\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\nimport strings from \"../locales\";\r\n\r\nconst STATE = {\r\n\tSENDING_ROM: 0,\r\n\tPLAYING: 1\r\n};\r\n\r\nexport default class MasterSyncer extends EventEmitter {\r\n\tconstructor(channel) {\r\n\t\tsuper();\r\n\r\n\t\tthis.channel = channel;\r\n\t\tthis._reset();\r\n\t\tthis.channel.on(\"data\", (bytes) => this._onData(bytes));\r\n\t}\r\n\r\n\tsync() {\r\n\t\tconst { masterBufferLimit } = config.buffering;\r\n\r\n\t\tif (\r\n\t\t\tthis._state !== STATE.PLAYING ||\r\n\t\t\tthis._blindFrames > masterBufferLimit\r\n\t\t) {\r\n\t\t\tbus.emit(\"isLoading\", true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tbus.emit(\"isLoading\", false);\r\n\t\tthis._runFrame();\r\n\t}\r\n\r\n\tinitializeRom(rom) {\r\n\t\tthis._transfer = new Send(rom, this.channel);\r\n\t\tthis._transfer.run();\r\n\t\tthis.emit(\"rom\", rom);\r\n\t}\r\n\r\n\tupdateRom(rom) {\r\n\t\tthis.channel.send(\"new-rom\");\r\n\t\tthis._reset();\r\n\t\tthis.initializeRom(rom);\r\n\t}\r\n\r\n\tinitializeEmulator(emulator) {\r\n\t\tthis._emulator = emulator;\r\n\r\n\t\temulator.localController.isMaster = true;\r\n\t\temulator.localController.needsSwap = false;\r\n\t\temulator.localController.player = 1;\r\n\t\temulator.remoteController.player = 2;\r\n\t\tbus.emit(\"player\", 1);\r\n\t}\r\n\r\n\tonStartPressed() {}\r\n\r\n\tonSwap() {\r\n\t\tconst player = this._emulator.localController.swapWith(\r\n\t\t\tthis._emulator.remoteController\r\n\t\t);\r\n\t\tbus.emit(\"player\", player);\r\n\t}\r\n\r\n\t_start() {\r\n\t\tthis._transfer = null;\r\n\t\tthis._state = STATE.PLAYING;\r\n\t\tthis.emit(\"start\");\r\n\t\tbus.emit(\"message\", null);\r\n\t\tbus.emit(\"isLoading\", false);\r\n\t}\r\n\r\n\t_runFrame() {\r\n\t\tconst { masterBufferLimit } = config.buffering;\r\n\r\n\t\t// buffer overrun\r\n\t\tif (this._buffer.length > masterBufferLimit) {\r\n\t\t\tconst excess = this._buffer.length - masterBufferLimit;\r\n\t\t\tfor (let i = 0; i < excess; i++) this._buffer.shift();\r\n\t\t}\r\n\r\n\t\tconst bytes = this._buffer.shift();\r\n\t\tif (bytes) {\r\n\t\t\t// normal scenario\r\n\t\t\tconst remoteButtons = new Uint8Array(bytes)[0];\r\n\t\t\tconst remoteControllerNeedsSwap = new Uint8Array(bytes)[1];\r\n\t\t\tthis._emulator.remoteController.syncAll(remoteButtons);\r\n\t\t\tif (\r\n\t\t\t\t(this._emulator.localController.player === 1 &&\r\n\t\t\t\t\tthis._emulator.localController.needsSwap) ||\r\n\t\t\t\t(this._emulator.remoteController.player === 1 &&\r\n\t\t\t\t\tremoteControllerNeedsSwap)\r\n\t\t\t)\r\n\t\t\t\tthis.onSwap();\r\n\t\t} else {\r\n\t\t\t// buffer underrun, do nothing (assume previous input)\r\n\t\t}\r\n\r\n\t\tconst buffer = new Uint8Array(3);\r\n\t\tbuffer[0] = this._emulator.localController.toByte();\r\n\t\tbuffer[1] = this._emulator.remoteController.toByte();\r\n\t\tbuffer[2] = this._emulator.localController.player;\r\n\t\tthis.channel.send(buffer);\r\n\t\tthis._blindFrames++;\r\n\r\n\t\tthis._emulator.frame();\r\n\t}\r\n\r\n\t_onData(bytes) {\r\n\t\tswitch (this._state) {\r\n\t\t\tcase STATE.SENDING_ROM:\r\n\t\t\t\tif (bytes === \"next\") {\r\n\t\t\t\t\tconst hasEnded = this._transfer.run();\r\n\t\t\t\t\tif (hasEnded) bus.emit(\"message\", strings.waiting);\r\n\t\t\t\t} else if (bytes === \"start\") this._start();\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase STATE.PLAYING:\r\n\t\t\t\tthis._buffer.push(bytes);\r\n\t\t\t\tthis._blindFrames = 0;\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t}\r\n\r\n\t_reset() {\r\n\t\tthis._state = STATE.SENDING_ROM;\r\n\t\tthis._transfer = null;\r\n\t\tthis._buffer = [];\r\n\t\tthis._blindFrames = 0;\r\n\r\n\t\tbus.emit(\"isLoading\", true);\r\n\t}\r\n}\r\n","import EventEmitter from \"eventemitter3\";\r\nimport { Receive } from \"./transfer\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\nimport strings from \"../locales\";\r\n\r\nconst STATE = {\r\n\tRECEIVING_ROM: 0,\r\n\tWAITING_START: 1,\r\n\tPLAYING: 2\r\n};\r\n\r\nexport default class SlaveSyncer extends EventEmitter {\r\n\tconstructor(channel) {\r\n\t\tsuper();\r\n\r\n\t\tthis.channel = channel;\r\n\t\tthis._reset();\r\n\t\tthis.channel.on(\"data\", (bytes) => this._onData(bytes));\r\n\t\tthis._hasPressedStart = false;\r\n\t}\r\n\r\n\tsync() {\r\n\t\tconst { minBufferSize, maxBufferSize } = config.buffering;\r\n\r\n\t\t// buffer underrun\r\n\t\tif (this._buffer.length < minBufferSize) {\r\n\t\t\tthis._isBuffering = true;\r\n\t\t\tbus.emit(\"isLoading\", true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// buffer overrun\r\n\t\tif (this._buffer.length > maxBufferSize) {\r\n\t\t\tconst excess = this._buffer.length - maxBufferSize;\r\n\t\t\tfor (let i = 0; i < excess; i++) this._runFrame();\r\n\t\t}\r\n\r\n\t\t// normal scenario\r\n\t\tif (this._isBuffering && this._buffer.length < maxBufferSize) return;\r\n\t\telse this._runFrame();\r\n\t}\r\n\r\n\tinitializeRom(rom) {}\r\n\r\n\tupdateRom(rom) {}\r\n\r\n\tinitializeEmulator(emulator) {\r\n\t\tthis._emulator = emulator;\r\n\r\n\t\tbus.emit(\"isLoading\", false);\r\n\t\temulator.localController.isMaster = false;\r\n\t\temulator.localController.needsSwap = false;\r\n\t\temulator.localController.player = 2;\r\n\t\temulator.remoteController.player = 1;\r\n\t\tbus.emit(\"player\", 2);\r\n\t}\r\n\r\n\tonStartPressed() {\r\n\t\tif (this._state === STATE.WAITING_START) {\r\n\t\t\tthis._hasPressedStart = true;\r\n\t\t\tthis._start();\r\n\t\t}\r\n\t}\r\n\r\n\tonSwap() {\r\n\t\tconst player = this._emulator.localController.swapWith(\r\n\t\t\tthis._emulator.remoteController\r\n\t\t);\r\n\t\tbus.emit(\"player\", player);\r\n\t}\r\n\r\n\t_start() {\r\n\t\tthis.emit(\"start\");\r\n\t\tthis.channel.send(\"start\");\r\n\t\tbus.emit(\"message\", null);\r\n\t\tthis._state = STATE.PLAYING;\r\n\t}\r\n\r\n\t_runFrame() {\r\n\t\tthis._isBuffering = false;\r\n\t\tbus.emit(\"isLoading\", false);\r\n\r\n\t\tconst bytes = this._buffer.shift();\r\n\t\tconst remoteButtons = new Uint8Array(bytes)[0];\r\n\t\tconst localButtons = new Uint8Array(bytes)[1];\r\n\t\tconst remotePlayer = new Uint8Array(bytes)[2];\r\n\t\tthis._emulator.remoteController.syncAll(remoteButtons);\r\n\t\tthis._emulator.localController.syncAll(localButtons);\r\n\t\tif (remotePlayer !== this._emulator.remoteController.player) this.onSwap();\r\n\r\n\t\tthis._emulator.frame();\r\n\t}\r\n\r\n\t_onData(bytes) {\r\n\t\tif (bytes === \"new-rom\") {\r\n\t\t\tthis._reset();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tswitch (this._state) {\r\n\t\t\tcase STATE.RECEIVING_ROM:\r\n\t\t\t\tif (bytes === \"end\") {\r\n\t\t\t\t\tthis.emit(\"rom\", this._transfer.rom);\r\n\t\t\t\t\tthis._transfer = null;\r\n\r\n\t\t\t\t\tif (this._hasPressedStart) this._start();\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tbus.emit(\"message\", strings.pressStart);\r\n\t\t\t\t\t\tthis._state = STATE.WAITING_START;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._transfer.run(bytes);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase STATE.PLAYING:\r\n\t\t\t\tif (!this._emulator) return;\r\n\r\n\t\t\t\tthis._buffer.push(bytes);\r\n\r\n\t\t\t\tconst buffer = new Uint8Array(2);\r\n\t\t\t\tbuffer[0] = this._emulator.localController.toByte();\r\n\t\t\t\tbuffer[1] = +this._emulator.localController.needsSwap;\r\n\t\t\t\tthis.channel.send(buffer);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t}\r\n\r\n\t_reset() {\r\n\t\tthis._state = STATE.RECEIVING_ROM;\r\n\t\tthis._transfer = new Receive(this.channel);\r\n\t\tthis._isBuffering = false;\r\n\t\tthis._buffer = [];\r\n\r\n\t\tbus.emit(\"isLoading\", true);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\nimport Header from \"../widgets/Header\";\r\nimport { MasterSyncer } from \"../networking\";\r\nimport quickp2p from \"quickp2p\";\r\nimport strings from \"../locales\";\r\n\r\nconst COPIED_MESSAGE_TIME = 1000;\r\n\r\nexport default class InviteHeader extends Component {\r\n\tstate = { token: null, copied: false, isDown: false };\r\n\r\n\trender() {\r\n\t\tconst { needsRom } = this.props;\r\n\t\tconst { token, copied, isDown } = this.state;\r\n\r\n\t\treturn (\r\n\t\t\t<Header>\r\n\t\t\t\t{copied ? (\r\n\t\t\t\t\t<span>{strings.copied}</span>\r\n\t\t\t\t) : needsRom ? (\r\n\t\t\t\t\t<span>{strings.dragARomHere}</span>\r\n\t\t\t\t) : token ? (\r\n\t\t\t\t\t<span>\r\n\t\t\t\t\t\t{strings.shareThis}{\" \"}\r\n\t\t\t\t\t\t<a\r\n\t\t\t\t\t\t\thref={`?token=${token}#/join`}\r\n\t\t\t\t\t\t\tonClick={this._copyLink}\r\n\t\t\t\t\t\t\ttabIndex=\"-1\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{strings.link}\r\n\t\t\t\t\t\t</a>{\" \"}\r\n\t\t\t\t\t\t{strings.toPlayWithSomeone}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t) : isDown ? (\r\n\t\t\t\t\t<span>{strings.errors.serverIsDown}</span>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<span>{strings.loading}</span>\r\n\t\t\t\t)}\r\n\t\t\t</Header>\r\n\t\t);\r\n\t}\r\n\r\n\tasync componentDidUpdate(nextProps) {\r\n\t\tconst { needsRom, onSyncer, onError } = this.props;\r\n\t\tif (needsRom || this.channel) return;\r\n\r\n\t\tconst onConnectionError = () => {\r\n\t\t\tthis.channel = null;\r\n\t\t\tthis.setState({ token: null, copied: false });\r\n\t\t\tonError();\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tthis.channel = await quickp2p.createChannel();\r\n\t\t\tthis.channel\r\n\t\t\t\t.on(\"connected\", () => {\r\n\t\t\t\t\tonSyncer(new MasterSyncer(this.channel));\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"timeout\", onConnectionError)\r\n\t\t\t\t.on(\"disconnected\", onConnectionError);\r\n\t\t\tthis.setState({ token: this.channel.token, isDown: false });\r\n\t\t} catch (e) {\r\n\t\t\tthis.setState({ isDown: true });\r\n\t\t}\r\n\t}\r\n\r\n\t_copyLink = (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tnavigator.clipboard.writeText(e.target.href);\r\n\t\tthis.setState({ copied: true });\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.setState({ copied: false });\r\n\t\t}, COPIED_MESSAGE_TIME);\r\n\t};\r\n}\r\n","import React, { Component } from \"react\";\r\nimport Header from \"../widgets/Header\";\r\nimport { SlaveSyncer } from \"../networking\";\r\nimport quickp2p from \"quickp2p\";\r\nimport strings from \"../locales\";\r\n\r\nexport default class JoinHeader extends Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Header>\r\n\t\t\t\t<span>{strings.connecting}</span>\r\n\t\t\t</Header>\r\n\t\t);\r\n\t}\r\n\r\n\tasync componentDidMount() {\r\n\t\tconst { onSyncer, onError } = this.props;\r\n\r\n\t\ttry {\r\n\t\t\tconst channel = await quickp2p.joinChannel(this.props.token);\r\n\t\t\tchannel\r\n\t\t\t\t.on(\"connected\", () => {\r\n\t\t\t\t\tonSyncer(new SlaveSyncer(channel));\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"timeout\", onError)\r\n\t\t\t\t.on(\"disconnected\", onError);\r\n\t\t} catch (e) {\r\n\t\t\tonError();\r\n\t\t}\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\n\r\nexport default class KeyBinding extends Component {\r\n\trender() {\r\n\t\tconst { displayName, isAssigning, verticalMirror = false } = this.props;\r\n\r\n\t\treturn (\r\n\t\t\t<button\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tclassName=\"nes-btn is-primary\"\r\n\t\t\t\tonClick={this._onAssign}\r\n\t\t\t>\r\n\t\t\t\t<span\r\n\t\t\t\t\tstyle={\r\n\t\t\t\t\t\tverticalMirror\r\n\t\t\t\t\t\t\t? { transform: \"scale(1, -1)\", display: \"inline-block\" }\r\n\t\t\t\t\t\t\t: null\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t{isAssigning ? \"...\" : displayName}\r\n\t\t\t\t</span>\r\n\t\t\t</button>\r\n\t\t);\r\n\t}\r\n\r\n\t_onAssign = () => {\r\n\t\tif (this.props.isAssigning) this.props.onAssignCancel();\r\n\t\telse this.props.onAssignStart();\r\n\t};\r\n}\r\n","import React, { Component } from \"react\";\r\nimport KeyBinding from \"../widgets/KeyBinding\";\r\nimport bus from \"../events\";\r\nimport config from \"../config\";\r\nimport strings from \"../locales\";\r\nimport styles from \"./Settings.module.css\";\r\nimport classNames from \"classnames\";\r\nimport _ from \"lodash\";\r\n\r\nconst DEFAULT_SCREEN_WIDTH = 1920;\r\n\r\nconst BUTTONS = [\r\n\t{ name: \"BUTTON_LEFT\", displayName: \"<\" },\r\n\t{ name: \"BUTTON_RIGHT\", displayName: \">\" },\r\n\t{ name: \"BUTTON_UP\", displayName: \"v\", verticalMirror: true },\r\n\t{ name: \"BUTTON_DOWN\", displayName: \"v\" },\r\n\t{ name: \"BUTTON_B\", displayName: \"B\" },\r\n\t{ name: \"BUTTON_A\", displayName: \"A\" },\r\n\t{ name: \"BUTTON_SELECT\", displayName: \"SELECT\" },\r\n\t{ name: \"BUTTON_START\", displayName: \"START\" },\r\n\t{ name: \"SWAP\", displayName: \"<SWAP>\" }\r\n];\r\n\r\nexport default class Settings extends Component {\r\n\tstate = { mappingButton: null };\r\n\r\n\tcomponentDidMount() {\r\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\r\n\t\twindow.addEventListener(\"resize\", this._onResize);\r\n\t\tthis._onResize();\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDown);\r\n\t\twindow.removeEventListener(\"resize\", this._onResize);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className={styles.settings} id=\"settings\">\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\tclassName={classNames(styles.closeButton, \"nes-btn\", \"is-error\")}\r\n\t\t\t\t\tonClick={this._onClose}\r\n\t\t\t\t>\r\n\t\t\t\t\tx\r\n\t\t\t\t</button>\r\n\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\tclassName={classNames(\r\n\t\t\t\t\t\tstyles.setDefaultsButton,\r\n\t\t\t\t\t\t\"nes-btn\",\r\n\t\t\t\t\t\t\"is-warning\"\r\n\t\t\t\t\t)}\r\n\t\t\t\t\tonClick={this._onSetDefaults}\r\n\t\t\t\t>\r\n\t\t\t\t\t{strings.setDefaults}\r\n\t\t\t\t</button>\r\n\r\n\t\t\t\t<section\r\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"title\">{strings.sound}</div>\r\n\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t{config.soundOptions.map((it) => (\r\n\t\t\t\t\t\t\t<label key={it.name}>\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\r\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\r\n\t\t\t\t\t\t\t\t\tname=\"sound\"\r\n\t\t\t\t\t\t\t\t\tchecked={config.options.sound === it.name}\r\n\t\t\t\t\t\t\t\t\tonChange={(e) => this._update(\"sound\", it.name)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<span>{it.name}</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t\t<br />\r\n\t\t\t\t<br />\r\n\r\n\t\t\t\t<section\r\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"title\">{strings.buffering}</div>\r\n\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t{config.bufferingOptions.map((it) => (\r\n\t\t\t\t\t\t\t<label key={it.name}>\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\r\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\r\n\t\t\t\t\t\t\t\t\tname=\"buffering\"\r\n\t\t\t\t\t\t\t\t\tchecked={config.options.buffering === it.name}\r\n\t\t\t\t\t\t\t\t\tonChange={() => this._update(\"buffering\", it.name)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<span>{it.name}</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t\t<br />\r\n\t\t\t\t<br />\r\n\r\n\t\t\t\t<section\r\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"title\">{strings.crtEffect}</div>\r\n\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t{[true, false].map((it) => (\r\n\t\t\t\t\t\t\t<label key={it}>\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\r\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\r\n\t\t\t\t\t\t\t\t\tname=\"crt\"\r\n\t\t\t\t\t\t\t\t\tchecked={config.options.crt === it}\r\n\t\t\t\t\t\t\t\t\tonChange={() => this._update(\"crt\", it)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<span>{strings[`enabled_${it}`]}</span>\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</section>\r\n\t\t\t\t<br />\r\n\t\t\t\t<br />\r\n\r\n\t\t\t\t<section\r\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div className=\"title\">{strings.input}</div>\r\n\r\n\t\t\t\t\t{BUTTONS.map((button) => (\r\n\t\t\t\t\t\t<KeyBinding\r\n\t\t\t\t\t\t\tkey={button.name}\r\n\t\t\t\t\t\t\tname={button.name}\r\n\t\t\t\t\t\t\tverticalMirror={button.verticalMirror}\r\n\t\t\t\t\t\t\tdisplayName={button.displayName}\r\n\t\t\t\t\t\t\tisAssigning={this.state.mappingButton === button.name}\r\n\t\t\t\t\t\t\tonAssignStart={() =>\r\n\t\t\t\t\t\t\t\tthis.setState({ mappingButton: button.name })\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tonAssignCancel={() => this.setState({ mappingButton: null })}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</section>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t_update(property, value) {\r\n\t\t_.set(config.options, property, value);\r\n\t\tconfig.save();\r\n\t\tthis._notify();\r\n\t}\r\n\r\n\t_notify() {\r\n\t\tbus.emit(\"volume\", config.sound.gain);\r\n\t\tbus.emit(\"keymap\");\r\n\r\n\t\tconst container = document.querySelector(\"#container\");\r\n\t\tif (config.options.crt) container.classList.add(\"crt\");\r\n\t\telse container.classList.remove(\"crt\");\r\n\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\r\n\t_onClose = () => {\r\n\t\tbus.emit(\"closeSettings\");\r\n\t};\r\n\r\n\t_onSetDefaults = () => {\r\n\t\tconfig.reset();\r\n\t\tthis._notify();\r\n\t};\r\n\r\n\t_onAssign = () => {\r\n\t\tif (this.props.isAssigning) return;\r\n\r\n\t\tthis.props.onAssignStart();\r\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\r\n\t};\r\n\r\n\t_onKeyDown = (e) => {\r\n\t\tif (!this.state.mappingButton) return;\r\n\r\n\t\te.preventDefault();\r\n\r\n\t\tconst oldKey = _.findKey(\r\n\t\t\tconfig.options.input,\r\n\t\t\t(it) => it === this.state.mappingButton\r\n\t\t);\r\n\t\tconst newKey = e.key;\r\n\r\n\t\tdelete config.options.input[oldKey];\r\n\t\tconfig.options.input[newKey] = this.state.mappingButton;\r\n\t\tconfig.save();\r\n\t\tthis._notify();\r\n\r\n\t\tthis.setState({ mappingButton: null });\r\n\t};\r\n\r\n\t_onResize = () => {\r\n\t\tconst width = window.innerWidth;\r\n\t\tconst element = document.querySelector(\"#settings\");\r\n\t\tconst scale = width / DEFAULT_SCREEN_WIDTH;\r\n\t\telement.style.transform = `scale(${scale})`;\r\n\t};\r\n}\r\n","import React, { Component } from \"react\";\r\nimport Loader from \"react-loader-spinner\";\r\nimport Settings from \"./Settings\";\r\nimport bus from \"../events\";\r\nimport styles from \"./Overlay.module.css\";\r\nimport classNames from \"classnames\";\r\n\r\nexport default class Overlay extends Component {\r\n\tstate = { isSettingsMenuOpen: false, isLoading: false, message: null };\r\n\r\n\trender() {\r\n\t\tconst { isVisible } = this;\r\n\t\tconst { isSettingsMenuOpen, isLoading, message } = this.state;\r\n\r\n\t\treturn (\r\n\t\t\t<div className={classNames(styles.overlay, isVisible && styles.show)}>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={classNames(styles.loader, message == null && styles.dark)}\r\n\t\t\t\t>\r\n\t\t\t\t\t{isSettingsMenuOpen ? (\r\n\t\t\t\t\t\t<Settings />\r\n\t\t\t\t\t) : message != null ? (\r\n\t\t\t\t\t\t<div className={styles.message}>{message}</div>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\tisLoading && (\r\n\t\t\t\t\t\t\t<Loader type=\"Watch\" color=\"#CCCCCC\" height=\"50\" width=\"50\" />\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tbus\r\n\t\t\t.on(\"isLoading\", (isLoading) => {\r\n\t\t\t\tthis.setState({ isLoading });\r\n\t\t\t})\r\n\t\t\t.on(\"message\", (message) => {\r\n\t\t\t\tthis.setState({ isLoading: false, message });\r\n\t\t\t})\r\n\t\t\t.on(\"openSettings\", () => {\r\n\t\t\t\tthis.setState({ isSettingsMenuOpen: true });\r\n\t\t\t})\r\n\t\t\t.on(\"closeSettings\", () => {\r\n\t\t\t\tthis.setState({ isSettingsMenuOpen: false });\r\n\t\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tbus.removeListener(\"isLoading\");\r\n\t\tbus.removeListener(\"message\");\r\n\t\tbus.removeListener(\"openSettings\");\r\n\t\tbus.removeListener(\"closeSettings\");\r\n\t}\r\n\r\n\tget isVisible() {\r\n\t\treturn (\r\n\t\t\tthis.state.isSettingsMenuOpen ||\r\n\t\t\tthis.state.isLoading ||\r\n\t\t\tthis.state.message != null\r\n\t\t);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\n\r\nconst SCREEN_WIDTH = 256;\r\nconst SCREEN_HEIGHT = 240;\r\n\r\nexport default class TVNoise extends Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<canvas\r\n\t\t\t\tstyle={{ width: \"100%\", height: \"100%\", borderRadius: 8 }}\r\n\t\t\t\twidth={SCREEN_WIDTH}\r\n\t\t\t\theight={SCREEN_HEIGHT}\r\n\t\t\t\tref={(canvas) => {\r\n\t\t\t\t\tif (canvas) this._initCanvas(canvas);\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tcancelAnimationFrame(this._frameId);\r\n\t}\r\n\r\n\t_initCanvas(canvas) {\r\n\t\tconst self = this;\r\n\t\tconst context = canvas.getContext(\"2d\");\r\n\r\n\t\tfunction noise(ctx) {\r\n\t\t\tlet w = ctx.canvas.width,\r\n\t\t\t\th = ctx.canvas.height,\r\n\t\t\t\tidata = ctx.createImageData(w, h),\r\n\t\t\t\tbuffer32 = new Uint32Array(idata.data.buffer),\r\n\t\t\t\tlen = buffer32.length,\r\n\t\t\t\ti = 0;\r\n\r\n\t\t\tfor (; i < len; ) buffer32[i++] = ((255 * Math.random()) | 0) << 24;\r\n\r\n\t\t\tctx.putImageData(idata, 0, 0);\r\n\t\t}\r\n\r\n\t\tlet toggle = true;\r\n\t\t(function loop() {\r\n\t\t\ttoggle = !toggle;\r\n\t\t\tif (toggle) {\r\n\t\t\t\tself._frameId = requestAnimationFrame(loop);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tnoise(context);\r\n\t\t\tself._frameId = requestAnimationFrame(loop);\r\n\t\t})();\r\n\t}\r\n}\r\n","import cleanQueryString from \"./cleanQueryString\";\r\nimport ellipsize from \"./ellipsize\";\r\n\r\nexport default { cleanQueryString, ellipsize };\r\n","export default () => {\r\n\tlet url;\r\n\turl = window.location.href;\r\n\turl = url.replace(url.substring(url.indexOf(\"?\")), \"\");\r\n\turl = url.substring(url.indexOf(\"//\") + 2);\r\n\turl = url.substring(url.indexOf(\"/\"));\r\n\twindow.history.replaceState({}, \"\", url);\r\n};\r\n","export default (string, limit) =>\r\n\t`${string.substring(0, limit)}${string.length > limit ? \"…\" : \"\"}`;\r\n","import React, { Component } from \"react\";\r\nimport config from \"../config\";\r\nimport strings from \"../locales\";\r\nimport helpers from \"../gui/helpers\";\r\nimport bus from \"../events\";\r\nimport styles from \"./Controls.module.css\";\r\nimport classNames from \"classnames\";\r\nimport _ from \"lodash\";\r\n\r\nconst TRICK_TIME = 100;\r\nconst FRIENDLY_NAMES = {\r\n\tArrowLeft: \"<\",\r\n\tArrowRight: \">\",\r\n\tArrowUp: \"~v\",\r\n\tArrowDown: \"v\",\r\n\t\" \": \"[Space]\"\r\n};\r\n\r\nexport default class Controls extends Component {\r\n\tstate = { player: 1 };\r\n\r\n\trender() {\r\n\t\tconst upKey = this._keyFor(\"BUTTON_UP\");\r\n\t\tconst isUpArrow = upKey === \"~v\";\r\n\r\n\t\treturn (\r\n\t\t\t<div className={styles.controls}>\r\n\t\t\t\t<b className={classNames(styles.title, styles.centered)}>\r\n\t\t\t\t\t{strings.controls}\r\n\t\t\t\t</b>\r\n\t\t\t\t<b className={classNames(styles.title, styles.centered)}>\r\n\t\t\t\t\t{this.state.player}P\r\n\t\t\t\t</b>\r\n\t\t\t\t{this.state.player === 1 ? (\r\n\t\t\t\t\t<b className={classNames(styles.dpad, styles.centered)}>\r\n\t\t\t\t\t\t({strings.swap}:{\" \"}\r\n\t\t\t\t\t\t{this.usesGamepad ? strings.swapButton : this._keyFor(\"SWAP\")})\r\n\t\t\t\t\t</b>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<br />\r\n\t\t\t\t)}\r\n\t\t\t\t<br />\r\n\t\t\t\t{this.usesGamepad ? (\r\n\t\t\t\t\t<div className={styles.centered}>{strings.yourController}</div>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<div className={styles.controller}>\r\n\t\t\t\t\t\t\t<span className={styles.dpad}>\r\n\t\t\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_LEFT\")}</span>{\" \"}\r\n\t\t\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_RIGHT\")}</span>{\" \"}\r\n\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\tstyle={\r\n\t\t\t\t\t\t\t\t\t\tisUpArrow\r\n\t\t\t\t\t\t\t\t\t\t\t? { transform: \"scale(1, -1)\", display: \"inline-block\" }\r\n\t\t\t\t\t\t\t\t\t\t\t: null\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{isUpArrow ? \"v\" : upKey}\r\n\t\t\t\t\t\t\t\t</span>{\" \"}\r\n\t\t\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_DOWN\")}</span>\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span className={styles.buttons}>\r\n\t\t\t\t\t\t\t\t{this._keyFor(\"BUTTON_B\")} {this._keyFor(\"BUTTON_A\")}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className={styles.startSelect}>\r\n\t\t\t\t\t\t\t{this._keyFor(\"BUTTON_SELECT\")} {this._keyFor(\"BUTTON_START\")}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tblink() {\r\n\t\tconst element = document.querySelector(\"#root\");\r\n\t\telement.classList.remove(\"blink\");\r\n\t\tsetTimeout(() => element.classList.add(\"blink\"), TRICK_TIME);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tbus\r\n\t\t\t.on(\"keymap\", () => {\r\n\t\t\t\tbus.emit(\"keymap-updated\");\r\n\t\t\t\tthis.forceUpdate();\r\n\t\t\t\tthis.blink();\r\n\t\t\t})\r\n\t\t\t.on(\"player\", (player) => {\r\n\t\t\t\tthis.setState({ player });\r\n\t\t\t\tthis.blink();\r\n\t\t\t})\r\n\t\t\t.on(\"gamepad\", this._onGamepadConnected)\r\n\t\t\t.on(\"reset\", () => {\r\n\t\t\t\tthis.setState({ player: 1 });\r\n\t\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tbus.removeListener(\"keymap\");\r\n\t}\r\n\r\n\t_onGamepadConnected = (e) => {\r\n\t\tthis.usesGamepad = true;\r\n\t\tthis.forceUpdate();\r\n\t\tthis.blink();\r\n\t};\r\n\r\n\t_keyFor(button) {\r\n\t\tconst key = _.findKey(config.options.input, (it) => it === button);\r\n\t\tif (!key) return \"[?]\";\r\n\r\n\t\treturn this._format(key);\r\n\t}\r\n\r\n\t_format(key) {\r\n\t\treturn (\r\n\t\t\tFRIENDLY_NAMES[key] ||\r\n\t\t\t(key.length === 1 ? key.toUpperCase() : `[${helpers.ellipsize(key, 6)}]`)\r\n\t\t);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\nimport bus from \"../events\";\r\nimport styles from \"./SettingsButton.module.css\";\r\nimport strings from \"../locales\";\r\n\r\nexport default class SettingsButton extends Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className={styles.button}>\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\ttabIndex=\"-1\"\r\n\t\t\t\t\tclassName=\"nes-btn\"\r\n\t\t\t\t\tonClick={this._onClick}\r\n\t\t\t\t>\r\n\t\t\t\t\t{strings.settings}\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t_onClick = () => {\r\n\t\tbus.emit(\"openSettings\");\r\n\t};\r\n}\r\n","import React, { Component } from \"react\";\r\nimport Emulator from \"../emulator\";\r\nimport InviteHeader from \"./InviteHeader\";\r\nimport JoinHeader from \"./JoinHeader\";\r\nimport Overlay from \"./Overlay\";\r\nimport Header from \"../widgets/Header\";\r\nimport TVNoise from \"../widgets/TVNoise\";\r\nimport Controls from \"../widgets/Controls\";\r\nimport SettingsButton from \"../widgets/SettingsButton\";\r\nimport helpers from \"./helpers\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\nimport styles from \"./PlayScreen.module.css\";\r\nimport strings from \"../locales\";\r\nimport classNames from \"classnames\";\r\nimport _ from \"lodash\";\r\nimport {Animated} from \"react-animated-css\";\r\n\r\n// DEBUG\r\nwindow.bus = require(\"../events\").default;\r\nwindow.config = require(\"../config\").default;\r\n\r\nexport default class PlayScreen extends Component {\r\n\tstate = { rom: null, syncer: null };\r\n\r\n\trender() {\r\n\t\tconst { token } = this.props;\r\n\t\tconst { rom, syncer } = this.state;\r\n\t\t// const { egg } = this.props;\r\n\r\n\t\t// console.log('Token: ' +token);\r\n\t\t// console.log('Rom: ' +rom);\r\n\t\t// console.log('Syncer: ' +syncer);\r\n\t\t// console.log('egg: ' +egg);\r\n\t\t// console.log('raw: ' +raw);\r\n\r\n\t\treturn (\r\n\t\t\t<div className={styles.app}>\r\n\t\t\t\t{syncer ? (\r\n\t\t\t\t\t<Header>{strings.connected}</Header>\r\n\t\t\t\t) : token ? (\r\n\t\t\t\t\t<Animated animationIn=\"bounceInLeft\" animationOut=\"fadeOut\" isVisible={true}>\r\n\r\n\t\t\t\t\t<JoinHeader\r\n\t\t\t\t\t\tonSyncer={this._onSyncer}\r\n\t\t\t\t\t\tonError={this._onError}\r\n\t\t\t\t\t\ttoken={token}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t</Animated>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<InviteHeader\r\n\t\t\t\t\t\tonSyncer={this._onSyncer}\r\n\t\t\t\t\t\tonError={this._onError}\r\n\t\t\t\t\t\tneedsRom={!rom}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{\r\n\t\t\t\t\t<div className={styles.main}>\r\n\t\t\t\t\t\t<section\r\n\t\t\t\t\t\t\tclassName={classNames(\r\n\t\t\t\t\t\t\t\tstyles.gameContainer,\r\n\t\t\t\t\t\t\t\t\"nes-container\",\r\n\t\t\t\t\t\t\t\t\"is-dark\",\r\n\t\t\t\t\t\t\t\t\"with-title\"\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div className={styles.overlay}>\r\n\t\t\t\t\t\t\t\t<Overlay />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{rom ? (\r\n\t\t\t\t\t\t\t\t<Emulator\r\n\t\t\t\t\t\t\t\t\trom={rom}\r\n\t\t\t\t\t\t\t\t\tsyncer={syncer}\r\n\t\t\t\t\t\t\t\t\tonStartPressed={this._onStartPressed}\r\n\t\t\t\t\t\t\t\t\tonError={this._onError}\r\n\t\t\t\t\t\t\t\t\tref={(ref) => (this.emulator = ref)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<TVNoise />\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\r\n\t\t\t\t<div className={styles.controls}>\r\n\t\t\t\t\t<Animated animationIn=\"bounceInDown\" animationOut=\"fadeOut\" isVisible={true}>\r\n\t\t\t\t\t\t<Controls />\r\n\t\t\t\t\t</Animated>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className={styles.menu}>\r\n\t\t\t\t\t<Animated animationIn=\"bounceInRight\" animationOut=\"fadeOut\" isVisible={true}>\r\n\t\t\t\t\t\t<SettingsButton />\r\n\t\t\t\t\t</Animated>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\twindow.addEventListener(\"dragover\", this._ignore);\r\n\t\twindow.addEventListener(\"dragenter\", this._ignore);\r\n\t\twindow.addEventListener(\"drop\", this._onFileDrop);\r\n\t\tif (config.options.crt)\r\n\t\t\tdocument.querySelector(\"#container\").classList.add(\"crt\");\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\twindow.removeEventListener(\"dragover\", this._ignore);\r\n\t\twindow.removeEventListener(\"dragenter\", this._ignore);\r\n\t\twindow.removeEventListener(\"drop\", this._onFileDrop);\r\n\t}\r\n\r\n\t_onSyncer = (syncer) => {\r\n\t\tthis.setState({ syncer });\r\n\r\n\t\tsyncer.on(\"rom\", (rom) => {\r\n\t\t\tthis._loadRom(rom, () => syncer.initializeEmulator(this.emulator), false);\r\n\t\t});\r\n\t\tsyncer.on(\"start\", () => this.emulator && this.emulator.start());\r\n\r\n\t\tsyncer.initializeRom(this.state.rom);\r\n\t};\r\n\r\n\t_loadRom(rom, callback = _.noop, start = true) {\r\n\t\tbus.emit(\"message\", null);\r\n\r\n\t\tthis.setState({ rom }, () => {\r\n\t\t\tcallback();\r\n\t\t\tif (start) this.emulator.start();\r\n\t\t});\r\n\t}\r\n\r\n\t_onFileDrop = (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tconst file = _.first(e.dataTransfer.files);\r\n\t\tconst reader = new FileReader();\r\n\t\tif (!file) return;\r\n\r\n\t\treader.onload = (event) => {\r\n\t\t\tconst rom = event.target.result;\r\n\r\n\t\t\tif (this.state.syncer) this.state.syncer.updateRom(rom);\r\n\t\t\telse this._loadRom(rom);\r\n\t\t};\r\n\r\n\t\treader.readAsArrayBuffer(file);\r\n\t};\r\n\r\n\t_ignore = (e) => {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\t};\r\n\r\n\t_onStartPressed = () => {\r\n\t\tif (!this.state.syncer) return;\r\n\t\tthis.state.syncer.onStartPressed();\r\n\t};\r\n\r\n\t_onError = (error, reset = true) => {\r\n\t\tthis.setState({ rom: null });\r\n\t\tbus.emit(\"message\", error || strings.errors.connectionFailed);\r\n\t\tif (!reset) return;\r\n\r\n\t\tbus.emit(\"reset\");\r\n\t\tthis.setState({ syncer: null });\r\n\t\thelpers.cleanQueryString();\r\n\t\twindow.location.href = \"#/\";\r\n\t};\r\n\r\n\t_dataURItoBlob(dataURI) {\r\n\t\tvar byteString = dataURI;\r\n\t\tvar ab = new ArrayBuffer(byteString.length);\r\n\t\tvar ia = new Uint8Array(ab);\r\n\t\tfor (var i = 0; i < byteString.length; i++) {\r\n\t\t\tia[i] = byteString.charCodeAt(i);\r\n\t\t}\r\n\t\tvar bb = new Blob([ab]);\r\n\t\treturn bb;\r\n\t}\r\n\r\n\t\r\n}\r\n\r\n","import React, { Component } from \"react\";\r\nimport Emulator from \"../emulator\";\r\nimport InviteHeader from \"./InviteHeader\";\r\nimport JoinHeader from \"./JoinHeader\";\r\nimport Overlay from \"./Overlay\";\r\nimport Header from \"../widgets/Header\";\r\nimport TVNoise from \"../widgets/TVNoise\";\r\nimport Controls from \"../widgets/Controls\";\r\nimport SettingsButton from \"../widgets/SettingsButton\";\r\nimport helpers from \"./helpers\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\nimport styles from \"./PlayScreenEgg.module.css\";\r\nimport strings from \"../locales\";\r\nimport classNames from \"classnames\";\r\nimport _ from \"lodash\";\r\nimport {Animated} from \"react-animated-css\";\r\n// import PlayScreen from \"./PlayScreen\";\r\n\r\n\r\n// DEBUG\r\nwindow.bus = require(\"../events\").default;\r\nwindow.config = require(\"../config\").default;\r\n\r\nexport default class PlayScreenEgg extends Component {\r\n\tstate = { rom: null, syncer: null };\r\n\tegg = this.props.egg;\r\n\r\n\trender() {\r\n\t\tconst { token } = this.props;\r\n\t\tconst { rom, syncer } = this.state;\r\n\t\t\r\n\r\n\t\t// console.log('Token: ' +token);\r\n\t\t// console.log('Rom: ' +rom);\r\n\t\t// console.log('Syncer: ' +syncer);\r\n\t\t// console.log(this.props.egg)\r\n\t\t// console.log('egg: ' + this.egg);\r\n\t\t\r\n\t\t\r\n\t\treturn (\r\n\t\t\t<div className={styles.appegg}>\r\n\t\t\t\t{syncer ? (\r\n\t\t\t\t\t<Header>{strings.connected}</Header>\r\n\t\t\t\t) : token ? (\r\n\t\t\t\t\t<Animated animationIn=\"bounceInLeft\" animationOut=\"fadeOut\" isVisible={true}>\r\n\r\n\t\t\t\t\t<JoinHeader\r\n\t\t\t\t\t\tonSyncer={this._onSyncer}\r\n\t\t\t\t\t\tonError={this._onError}\r\n\t\t\t\t\t\ttoken={token}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t</Animated>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<InviteHeader\r\n\t\t\t\t\t\tonSyncer={this._onSyncer}\r\n\t\t\t\t\t\tonError={this._onError}\r\n\t\t\t\t\t\tneedsRom={!rom}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{\r\n\t\t\t\t\t<div className={styles.main}>\r\n\t\t\t\t\t\t<section\r\n\t\t\t\t\t\t\tclassName={classNames(\r\n\t\t\t\t\t\t\t\tstyles.gameContainer,\r\n\t\t\t\t\t\t\t\t\"nes-container\",\r\n\t\t\t\t\t\t\t\t\"is-dark\",\r\n\t\t\t\t\t\t\t\t\"with-title\"\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div className={styles.overlay}>\r\n\t\t\t\t\t\t\t\t<Overlay />\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{rom ? (\r\n\t\t\t\t\t\t\t\t<Emulator\r\n\t\t\t\t\t\t\t\t\trom={rom}\r\n\t\t\t\t\t\t\t\t\tsyncer={syncer}\r\n\t\t\t\t\t\t\t\t\tonStartPressed={this._onStartPressed}\r\n\t\t\t\t\t\t\t\t\tonError={this._onError}\r\n\t\t\t\t\t\t\t\t\tref={(ref) => (this.emulator = ref)}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<TVNoise />\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\r\n\t\t\t\t<div className={styles.controls}>\r\n\t\t\t\t\t<Animated animationIn=\"bounceInDown\" animationOut=\"fadeOut\" isVisible={true}>\r\n\t\t\t\t\t\t<Controls />\r\n\t\t\t\t\t</Animated>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className={styles.menu}>\r\n\t\t\t\t\t<Animated animationIn=\"bounceInRight\" animationOut=\"fadeOut\" isVisible={true}>\r\n\t\t\t\t\t\t<SettingsButton />\r\n\t\t\t\t\t</Animated>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\twindow.addEventListener(\"dragover\", this._ignore);\r\n\t\twindow.addEventListener(\"dragenter\", this._ignore);\r\n\t\twindow.addEventListener(\"drop\", this._ignore);\r\n\t\twindow.addEventListener('load', this.load);\r\n\t\tif (config.options.crt)\r\n\t\t\tdocument.querySelector(\"#container\").classList.add(\"crt\");\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\twindow.removeEventListener(\"dragover\", this._ignore);\r\n\t\twindow.removeEventListener(\"dragenter\", this._ignore);\r\n\t\twindow.removeEventListener(\"drop\", this._ignore);\r\n\t\twindow.removeEventListener('load', this.load)  \r\n\r\n\t}\r\n\r\n\t_onSyncer = (syncer) => {\r\n\t\tthis.setState({ syncer });\r\n\r\n\t\tsyncer.on(\"rom\", (rom) => {\r\n\t\t\tthis._loadRom(rom, () => syncer.initializeEmulator(this.emulator), false);\r\n\t\t});\r\n\t\tsyncer.on(\"start\", () => this.emulator && this.emulator.start());\r\n\r\n\t\tsyncer.initializeRom(this.state.rom);\r\n\t};\r\n\r\n\t_loadRom(rom, callback = _.noop, start = true) {\r\n\t\tbus.emit(\"message\", null);\r\n\r\n\t\tthis.setState({ rom }, () => {\r\n\t\t\tcallback();\r\n\t\t\tif (start) this.emulator.start();\r\n\t\t});\r\n\t}\r\n\r\n\t_onFileDrop = (e) => {\r\n\t\te.preventDefault();\r\n\r\n\t\tconst file = _.first(e.dataTransfer.files);\r\n\t\tconst reader = new FileReader();\r\n\t\tif (!file) return;\r\n\r\n\t\treader.onload = (event) => {\r\n\t\t\tconst rom = event.target.result;\r\n\r\n\t\t\tif (this.state.syncer) this.state.syncer.updateRom(rom);\r\n\t\t\telse this._loadRom(rom);\r\n\t\t};\r\n\r\n\t\treader.readAsArrayBuffer(file);\r\n\t};\r\n\r\n\t_ignore = (e) => {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\t};\r\n\r\n\t_onStartPressed = () => {\r\n\t\tif (!this.state.syncer) return;\r\n\t\tthis.state.syncer.onStartPressed();\r\n\t};\r\n\r\n\t_onError = (error, reset = true) => {\r\n\t\tthis.setState({ rom: null });\r\n\t\tbus.emit(\"message\", error || strings.errors.connectionFailed);\r\n\t\tif (!reset) return;\r\n\r\n\t\tbus.emit(\"reset\");\r\n\t\tthis.setState({ syncer: null });\r\n\t\thelpers.cleanQueryString();\r\n\t\twindow.location.href = \"#/\";\r\n\t};\r\n\r\n\t_dataURItoBlob(dataURI) {\r\n\t\tvar byteString = dataURI;\r\n\t\tvar ab = new ArrayBuffer(byteString.length);\r\n\t\tvar ia = new Uint8Array(ab);\r\n\t\tfor (var i = 0; i < byteString.length; i++) {\r\n\t\t\tia[i] = byteString.charCodeAt(i);\r\n\t\t}\r\n\t\tvar bb = new Blob([ab]);\r\n\t\treturn bb;\r\n\t}\r\n\r\n\r\n\tloadBinary(path, callback) {\r\n\t\tvar req = new XMLHttpRequest();\r\n\t\treq.open(\"GET\", path);\r\n\t\treq.responseType = \"arraybuffer\";\r\n\t\treq.addEventListener('load', function() {\r\n\t\t  if (req.status === 200) {\r\n\t\t\tcallback(null, this.response);\r\n\t\t  } else {\r\n\t\t\tcallback(new Error(req.statusText));\r\n\t\t  }\r\n\t\t});\r\n\t\treq.onerror = function() {\r\n\t\t  callback(new Error(req.statusText));\r\n\t\t};\r\n\t\treq.send();\r\n\t}\r\n\t\r\n\t\r\n\tload = () => {\r\n\t\tthis.loadBinary('https://raw.githubusercontent.com/roodriiigooo/EGGS/main/' +this.egg, (err, data) => {\r\n\t\t  if (err) {\r\n\t\t\tthis.syncer = { rom: null, syncer: null };\r\n\t\t\thelpers.cleanQueryString();\r\n\t\t\tthis._onError();\r\n\t\t\t// return <PlayScreen />;\r\n\t\t\t// window.alert(`Error loading ROM: ${err.toString()}`);\r\n\t\t  } else {\r\n\t\t\tthis.handleLoaded(data);\r\n\t\t  }\r\n\t\t});\r\n\t  };\r\n\t\r\n\thandleLoaded = data => {\r\n\t\tthis.setState({ rom: null });\r\n\t\tthis.setState({ syncer: null });\r\n\t\thelpers.cleanQueryString();\r\n\t\tif (this.state.syncer) this.state.syncer.updateRom(data);\r\n\t\t\telse this._loadRom(data);\r\n\t};\r\n\r\n\t\r\n}\r\n\r\n","import React, { PureComponent } from \"react\";\nimport PlayScreen from \"./gui/PlayScreen\";\nimport querystring from \"query-string\";\nimport quickp2p, { SimpleStore } from \"quickp2p\";\nimport PlayScreenEgg from \"./gui/PlayScreenEgg\";\n\n// quickp2p.setStore(new SimpleStore(\"https://misc.r-labs.io\"));\nquickp2p.setStore(\n\tnew SimpleStore(\n\t\t\"https://tokens.rodrigo.londrina.br/.netlify/functions/server\"\n\t)\n);\n// quickp2p.setStore(new SimpleStore(\"http://localhost:5000\"));\n\nexport default class App extends PureComponent {\n\trender() {\n\t\tconst route = window.location.hash;\n\n\t\tif (route.startsWith(\"#/join\")) {\n\t\t\treturn <PlayScreen token={this.inviteToken} />;\n\t\t\t// else if (route.startsWith(\"#/egg\")) {\n\t\t\t// \treturn <PlayScreenEgg egg={this.eggToken} />;\n\t\t} else return <PlayScreen />;\n\t}\n\n\tUNSAFE_componentWillMount() {\n\t\tthis._listener = window.addEventListener(\"hashchange\", (e) => {\n\t\t\tthis.forceUpdate();\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"hashchange\", this._listener);\n\t}\n\n\tget inviteToken() {\n\t\treturn querystring.parse(window.location.search).token;\n\t}\n\n\tget eggToken() {\n\t\treturn querystring.parse(window.location.search).egg;\n\t}\n}\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport \"nes.css/css/nes.css\";\r\nimport \"./index.css\";\r\nimport \"./crt.css\";\r\nimport \"./assets/animate.min.css\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__31Pzs\",\"small\":\"Header_small__s-C87\",\"message\":\"Header_message__3HU8Y\",\"title\":\"Header_title__dsLcg\",\"titleLogo\":\"Header_titleLogo__3haEv\",\"titleText\":\"Header_titleText__24rZs\",\"link\":\"Header_link__2VlsV\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"overlay\":\"Overlay_overlay__1xMsU\",\"show\":\"Overlay_show__2zg7a\",\"loader\":\"Overlay_loader__1-pwz\",\"dark\":\"Overlay_dark__3Ahzq\",\"message\":\"Overlay_message__8ZHHR\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"settings\":\"Settings_settings__3F41t\",\"closeButton\":\"Settings_closeButton__3UiKv\",\"setDefaultsButton\":\"Settings_setDefaultsButton__2bnJr\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"balloon\":\"BalloonMessage_balloon__BjJlJ\",\"character\":\"BalloonMessage_character__3n8lP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"screen\":\"Screen_screen__2E4B5\"};","module.exports = __webpack_public_path__ + \"static/media/rodrigo_profile_picture.39873869.png\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"SettingsButton_button__3AkWQ\"};","const KEY = \"options\";\r\nconst HALF_VOLUME = \"50%\";\r\nconst LOW = \"Curto\";\r\n\r\nclass Config {\r\n\tconstructor() {\r\n\t\tthis.options = this.defaultOptions;\r\n\t\tthis.load();\r\n\t}\r\n\r\n\tsave() {\r\n\t\tlocalStorage.setItem(KEY, JSON.stringify(this.options));\r\n\t}\r\n\r\n\tload() {\r\n\t\ttry {\r\n\t\t\tthis.options =\r\n\t\t\t\tJSON.parse(localStorage.getItem(KEY)) || this.defaultOptions;\r\n\t\t} catch (e) {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t}\r\n\r\n\treset() {\r\n\t\tthis.options = this.defaultOptions;\r\n\t\tthis.save();\r\n\t}\r\n\r\n\tget sound() {\r\n\t\treturn this.soundOptions.find((it) => it.name === this.options.sound);\r\n\t}\r\n\r\n\tget buffering() {\r\n\t\treturn this.bufferingOptions.find(\r\n\t\t\t(it) => it.name === this.options.buffering\r\n\t\t);\r\n\t}\r\n\r\n\tget defaultOptions() {\r\n\t\treturn {\r\n\t\t\tsound: HALF_VOLUME,\r\n\t\t\tbuffering: LOW,\r\n\t\t\tcrt: true,\r\n\t\t\tinput: {\r\n\t\t\t\tz: \"BUTTON_A\",\r\n\t\t\t\tx: \"BUTTON_B\",\r\n\t\t\t\tDelete: \"BUTTON_SELECT\",\r\n\t\t\t\tEnter: \"BUTTON_START\",\r\n\t\t\t\tArrowUp: \"BUTTON_UP\",\r\n\t\t\t\tArrowDown: \"BUTTON_DOWN\",\r\n\t\t\t\tArrowLeft: \"BUTTON_LEFT\",\r\n\t\t\t\tArrowRight: \"BUTTON_RIGHT\",\r\n\t\t\t\tr: \"SWAP\"\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tget soundOptions() {\r\n\t\treturn [\r\n\t\t\t{ name: \"100%\", gain: 1 },\r\n\t\t\t{ name: \"90%\", gain: 0.9 },\r\n\t\t\t{ name: \"75%\", gain: 0.75 },\r\n\t\t\t{ name: HALF_VOLUME, gain: 0.5 },\r\n\t\t\t{ name: \"25%\", gain: 0.25 },\r\n\t\t\t{ name: \"10%\", gain: 0.1 },\r\n\t\t\t{ name: \"0%\", gain: 0 }\r\n\t\t];\r\n\t}\r\n\r\n\tget bufferingOptions() {\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tname: \"Desabilitado\",\r\n\t\t\t\tmasterBufferLimit: 3,\r\n\t\t\t\tminBufferSize: 1,\r\n\t\t\t\tmaxBufferSize: 1\r\n\t\t\t},\r\n\t\t\t{ name: LOW, masterBufferLimit: 3, minBufferSize: 1, maxBufferSize: 2 },\r\n\t\t\t{\r\n\t\t\t\tname: \"Medio\",\r\n\t\t\t\tmasterBufferLimit: 5,\r\n\t\t\t\tminBufferSize: 2,\r\n\t\t\t\tmaxBufferSize: 3\r\n\t\t\t},\r\n\t\t\t{ name: \"Alto\", masterBufferLimit: 5, minBufferSize: 3, maxBufferSize: 5 }\r\n\t\t];\r\n\t}\r\n}\r\n\r\nexport default new Config();\r\n"],"sourceRoot":""}